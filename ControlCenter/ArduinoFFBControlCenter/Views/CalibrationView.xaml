<UserControl x:Class="ArduinoFFBControlCenter.Views.CalibrationView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:helpers="clr-namespace:ArduinoFFBControlCenter.Helpers">
    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <StackPanel Margin="24" helpers:PanelSpacing.Spacing="16">
            <Border Style="{StaticResource Card}">
                <StackPanel>
                    <TextBlock Text="Calibration Status" FontSize="16" FontWeight="SemiBold" />
                    <TextBlock Text="{Binding SerialConfigNotice}" Foreground="{StaticResource MutedText}" Margin="0,4,0,0" TextWrapping="Wrap" />
                    <TextBlock Text="{Binding CalibrationStatus}" FontSize="20" FontWeight="Bold" Margin="0,6,0,0" />
                    <TextBlock Text="{Binding CalibrationReason}" Foreground="{StaticResource MutedText}" TextWrapping="Wrap" Margin="0,4,0,0" />
                    <Button Content="Re-check" Command="{Binding AssessCommand}" Style="{StaticResource AccentButton}" Margin="0,10,0,0" />
                </StackPanel>
            </Border>

            <Border Style="{StaticResource Card}">
                <StackPanel>
                    <TextBlock Text="Calibration Wizard" FontSize="16" FontWeight="SemiBold" />
                    <TextBlock Text="{Binding StepTitle}" FontSize="20" FontWeight="Bold" Margin="0,6,0,0" />
                    <TextBlock Text="{Binding StepHint}" Foreground="{StaticResource MutedText}" TextWrapping="Wrap" Margin="0,4,0,0" />
                    <StackPanel Orientation="Horizontal" helpers:PanelSpacing.Spacing="12" Margin="0,10,0,0">
                        <Button Content="Back" Command="{Binding BackCommand}" />
                        <Button Content="Next" Command="{Binding NextCommand}" />
                    </StackPanel>
                </StackPanel>
            </Border>

            <Border Style="{StaticResource Card}" Visibility="{Binding StepIndex, Converter={StaticResource StepVisibility}, ConverterParameter=0}">
                <StackPanel>
                    <TextBlock Text="Safety" FontWeight="SemiBold" />
                    <TextBlock Text="Set strength to a low value. Force tests are locked until calibration is complete." Foreground="{StaticResource MutedText}" TextWrapping="Wrap" Margin="0,6,0,0" />
                </StackPanel>
            </Border>

            <Border Style="{StaticResource Card}" Visibility="{Binding StepIndex, Converter={StaticResource StepVisibility}, ConverterParameter=1}">
                <StackPanel>
                    <TextBlock Text="Center" FontWeight="SemiBold" />
                    <TextBlock Text="Let go of the wheel, then capture center." Foreground="{StaticResource MutedText}" Margin="0,6,0,0" />
                    <Button Content="Capture Center" Command="{Binding CaptureCenterCommand}" Style="{StaticResource AccentButton}" Margin="0,8,0,0" />
                    <TextBlock Text="{Binding CenterStatus}" Foreground="{StaticResource MutedText}" Margin="0,6,0,0" />
                </StackPanel>
            </Border>

            <Border Style="{StaticResource Card}" Visibility="{Binding StepIndex, Converter={StaticResource StepVisibility}, ConverterParameter=2}">
                <StackPanel>
                    <TextBlock Text="Direction" FontWeight="SemiBold" />
                    <TextBlock Text="Turn the wheel right slowly and test direction." Foreground="{StaticResource MutedText}" Margin="0,6,0,0" />
                    <Button Content="Test Direction" Command="{Binding DetectDirectionCommand}" Style="{StaticResource AccentButton}" Margin="0,8,0,0" />
                    <CheckBox Content="Invert direction (requires firmware support)" IsChecked="{Binding InvertDirection}" Margin="0,8,0,0" />
                    <TextBlock Text="{Binding DirectionStatus}" Foreground="{StaticResource MutedText}" Margin="0,6,0,0" />
                </StackPanel>
            </Border>

            <Border Style="{StaticResource Card}" Visibility="{Binding StepIndex, Converter={StaticResource StepVisibility}, ConverterParameter=3}">
                <StackPanel>
                    <TextBlock Text="Rotation" FontWeight="SemiBold" />
                    <TextBlock Text="Set degrees of rotation and verify end range." Foreground="{StaticResource MutedText}" Margin="0,6,0,0" />
                    <StackPanel Orientation="Horizontal" helpers:PanelSpacing.Spacing="8" Margin="0,6,0,0">
                        <TextBlock Text="Degrees" VerticalAlignment="Center" />
                        <TextBox Width="80" Text="{Binding RotationDeg}" />
                        <Button Content="Apply" Command="{Binding ApplyRotationCommand}" />
                        <Button Content="Verify Range" Command="{Binding VerifyRotationCommand}" />
                    </StackPanel>
                    <TextBlock Text="{Binding RotationStatus}" Foreground="{StaticResource MutedText}" Margin="0,6,0,0" />
                </StackPanel>
            </Border>

            <Border Style="{StaticResource Card}" Visibility="{Binding StepIndex, Converter={StaticResource StepVisibility}, ConverterParameter=4}">
                <StackPanel>
                    <TextBlock Text="Endstops" FontWeight="SemiBold" />
                    <TextBlock Text="Optional: test soft lock/endstop at low strength." Foreground="{StaticResource MutedText}" Margin="0,6,0,0" />
                    <TextBlock Text="Soft lock test requires firmware support." Foreground="{StaticResource MutedText}" Margin="0,6,0,0" />
                </StackPanel>
            </Border>

            <Border Style="{StaticResource Card}" Visibility="{Binding StepIndex, Converter={StaticResource StepVisibility}, ConverterParameter=5}">
                <StackPanel>
                    <TextBlock Text="Save" FontWeight="SemiBold" />
                    <TextBlock Text="Save calibration to wheel or PC." Foreground="{StaticResource MutedText}" Margin="0,6,0,0" />
                    <Button Content="Save Calibration" Command="{Binding SaveCommand}" Style="{StaticResource AccentButton}" Margin="0,8,0,0" />
                    <TextBlock Text="{Binding SaveNotice}" Foreground="{StaticResource MutedText}" Margin="0,6,0,0" />
                    <TextBlock Text="{Binding SaveStatus}" Foreground="{StaticResource MutedText}" Margin="0,6,0,0" />
                </StackPanel>
            </Border>

            <Border Style="{StaticResource Card}" Visibility="{Binding StepIndex, Converter={StaticResource StepVisibility}, ConverterParameter=6}">
                <StackPanel>
                    <TextBlock Text="Summary" FontWeight="SemiBold" />
                    <TextBlock Text="Calibration complete. You can redo calibration at any time." Foreground="{StaticResource MutedText}" Margin="0,6,0,0" />
                    <TextBlock>
                        <Run Text="Rotation: " />
                        <Run Text="{Binding RotationDeg}" />
                    </TextBlock>
                    <TextBlock>
                        <Run Text="Center: " />
                        <Run Text="{Binding CenterStatus}" />
                    </TextBlock>
                    <TextBlock>
                        <Run Text="Invert: " />
                        <Run Text="{Binding InvertDirection}" />
                    </TextBlock>
                    <TextBlock>
                        <Run Text="Save: " />
                        <Run Text="{Binding SaveStatus}" />
                    </TextBlock>
                    <TextBlock>
                        <Run Text="Timestamp: " />
                        <Run Text="{Binding LastCalibrationTimestamp}" />
                    </TextBlock>
                </StackPanel>
            </Border>
        </StackPanel>
    </ScrollViewer>
</UserControl>


