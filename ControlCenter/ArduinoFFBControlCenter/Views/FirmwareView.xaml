<UserControl x:Class="ArduinoFFBControlCenter.Views.FirmwareView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:helpers="clr-namespace:ArduinoFFBControlCenter.Helpers">
    <Grid Margin="24">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="2*" />
            <ColumnDefinition Width="3*" />
        </Grid.ColumnDefinitions>

        <StackPanel Grid.Column="0" helpers:PanelSpacing.Spacing="12">
            <Border Style="{StaticResource Card}">
                <StackPanel>
                    <TextBlock Text="Firmware Library" FontSize="16" FontWeight="SemiBold" />
                    <ListBox ItemsSource="{Binding FirmwareOptions}" SelectedItem="{Binding SelectedFirmware}" Margin="0,8,0,0" DisplayMemberPath="Name" Height="300" />
                    <TextBlock Text="{Binding LastGoodHexName, StringFormat=Last known good: {0}}" Foreground="{StaticResource MutedText}" Margin="0,6,0,0" />
                    <StackPanel Orientation="Horizontal" helpers:PanelSpacing.Spacing="8" Margin="0,8,0,0">
                        <Button Content="Reload Library" Command="{Binding ReloadLibraryCommand}" />
                        <Button Content="Add Custom HEX" Command="{Binding BrowseCustomHexCommand}" />
                        <Button Content="Rollback" Command="{Binding RollbackCommand}" IsEnabled="{Binding CanRollback}" />
                    </StackPanel>
                </StackPanel>
            </Border>

            <Border Style="{StaticResource Card}">
                <StackPanel>
                    <TextBlock Text="Port" FontWeight="SemiBold" />
                    <ComboBox ItemsSource="{Binding AvailablePorts}" SelectedItem="{Binding SelectedPort}" Margin="0,6,0,0" />
                    <StackPanel Orientation="Horizontal" helpers:PanelSpacing.Spacing="8" Margin="0,6,0,0">
                        <Button Content="Scan Ports" Command="{Binding ScanPortsCommand}" />
                        <Button Content="Auto-Detect" Command="{Binding AutoDetectPortCommand}" />
                    </StackPanel>
                </StackPanel>
            </Border>

            <StackPanel Orientation="Horizontal" helpers:PanelSpacing.Spacing="8">
                <Button Content="Flash Selected" Command="{Binding FlashSelectedCommand}" Style="{StaticResource AccentButton}" IsEnabled="{Binding IsFlashing, Converter={StaticResource InverseBool}}" />
                <Button Content="Factory Restore" Command="{Binding FactoryRestoreCommand}" IsEnabled="{Binding IsFlashing, Converter={StaticResource InverseBool}}" />
                <Button Content="Manual Recovery" Command="{Binding ManualRecoveryCommand}" IsEnabled="{Binding IsFlashing, Converter={StaticResource InverseBool}}" />
                <Button Content="Open Legacy GUI" Command="{Binding OpenLegacyGuiCommand}" />
            </StackPanel>
        </StackPanel>

        <Border Grid.Column="1" Style="{StaticResource Card}" Margin="16,0,0,0">
            <StackPanel>
                <TextBlock Text="Flash Output" FontSize="16" FontWeight="SemiBold" />
                <TextBlock Text="{Binding FlashStatus}" Foreground="{StaticResource MutedText}" Margin="0,6,0,0" />
                <TextBlock Text="{Binding FlashHint}" Foreground="{StaticResource MutedText}" TextWrapping="Wrap" />
                <TextBox Text="{Binding FlashLog}" Margin="0,8,0,0" Height="420" AcceptsReturn="True" VerticalScrollBarVisibility="Auto" Background="#0F151C" Foreground="#D7E3F3" BorderBrush="{StaticResource CardBorder}" />
                <TextBlock Text="Note: Board is locked to Leonardo (ATmega32U4)." Foreground="{StaticResource MutedText}" Margin="0,8,0,0" />
            </StackPanel>
        </Border>
    </Grid>
</UserControl>


